class DOMSecurity{static setTextContent(element,text){if(!element||typeof text!=='string')return
element.textContent=text}
static clearContent(element){if(!element)return
while(element.firstChild){element.removeChild(element.firstChild)}}
static createElement(tagName,text='',attributes={}){const element=document.createElement(tagName)
if(text){element.textContent=text}
Object.entries(attributes).forEach(([key,value])=>{if(typeof value==='string'||typeof value==='number'){element.setAttribute(key,String(value))}})
return element}
static createCheckboxOption(id,value,label){const container=document.createElement('div')
container.className='option-item'
const checkbox=document.createElement('input')
checkbox.type='checkbox'
checkbox.id=id
checkbox.value=this.sanitizeAttribute(value)
checkbox.addEventListener('change',function(e){this.checked=e.target.checked})
const labelElement=document.createElement('label')
labelElement.setAttribute('for',id)
labelElement.textContent=label
container.addEventListener('click',function(e){if(e.target!==checkbox&&e.target!==labelElement){checkbox.checked=!checkbox.checked
checkbox.dispatchEvent(new Event('change',{bubbles:true}))}})
container.appendChild(checkbox)
container.appendChild(labelElement)
return container}
static createNotification(title,message,type='info'){const notification=document.createElement('div')
notification.className='in-page-notification'
const content=document.createElement('div')
content.className='in-page-notification-content'
const titleElement=document.createElement('div')
titleElement.className='in-page-notification-title'
titleElement.textContent=title
const messageElement=document.createElement('div')
messageElement.className='in-page-notification-message'
messageElement.textContent=message
const closeButton=document.createElement('button')
closeButton.className='in-page-notification-close'
closeButton.textContent='Ã—'
closeButton.setAttribute('aria-label','å…³é—­é€šçŸ¥')
content.appendChild(titleElement)
content.appendChild(messageElement)
content.appendChild(closeButton)
notification.appendChild(content)
return notification}
static createImagePreview(imageItem,isLoading=false){const previewElement=document.createElement('div')
previewElement.className='image-preview-item'
previewElement.id=`preview-${imageItem.id}`
if(isLoading){const loadingDiv=document.createElement('div')
loadingDiv.className='image-loading'
const spinner=document.createElement('div')
spinner.className='loading-spinner'
const text=document.createElement('div')
text.textContent='å¤„ç†ä¸­...'
loadingDiv.appendChild(spinner)
loadingDiv.appendChild(text)
previewElement.appendChild(loadingDiv)}else{const img=document.createElement('img')
img.src=imageItem.previewUrl
img.alt=this.sanitizeAttribute(imageItem.name)
img.className='image-preview-thumbnail'
const removeButton=document.createElement('button')
removeButton.className='image-remove-btn'
removeButton.textContent='Ã—'
removeButton.setAttribute('aria-label','åˆ é™¤å›¾ç‰‡')
removeButton.onclick=()=>removeImage(imageItem.id)
const info=document.createElement('div')
info.className='image-info'
info.textContent=`${imageItem.name} (${(imageItem.size / 1024).toFixed(1)}KB)`
previewElement.appendChild(img)
previewElement.appendChild(removeButton)
previewElement.appendChild(info)}
return previewElement}
static createCopyButton(targetText){const button=document.createElement('button')
button.className='copy-button'
button.textContent='ðŸ“‹ å¤åˆ¶'
button.setAttribute('aria-label','å¤åˆ¶ä»£ç ')
button.addEventListener('click',async()=>{try{await navigator.clipboard.writeText(targetText)
this.updateButtonState(button,'âœ… å·²å¤åˆ¶','copied')}catch(err){this.updateButtonState(button,'âŒ å¤åˆ¶å¤±è´¥','error')}})
return button}
static updateButtonState(button,text,className,duration=2000){const originalText=button.textContent
const originalClasses=button.className
button.textContent=text
button.classList.add(className)
setTimeout(()=>{button.textContent=originalText
button.className=originalClasses},duration)}
static sanitizeAttribute(value){if(typeof value!=='string')return''
return value.replace(/[<>'"&]/g,(match)=>{const entities={'<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','&':'&amp;'}
return entities[match]||match}).trim()}
static sanitizeText(text){if(typeof text!=='string')return''
const div=document.createElement('div')
div.textContent=text
return div.textContent||div.innerText||''}
static replaceContent(element,content){if(!element)return
this.clearContent(element)
if(content instanceof DocumentFragment||content instanceof HTMLElement){element.appendChild(content)}}
static createFragment(){return document.createDocumentFragment()}
static isValidURL(url){if(typeof url!=='string')return false
try{const urlObj=new URL(url)
return['http:','https:','data:'].includes(urlObj.protocol)}catch{return false}}
static setSafeSource(element,url){if(!element||!this.isValidURL(url))return
element.src=url}}
window.DOMSecurity=DOMSecurity